#include <string.h>  // Include for strcmp and strcspn
#include <stddef.h>  // Include for size_t
#include "utils.h"   // Include for function declarations

int main() {
    // Initialize arrays to avoid passing uninitialized arrays to load_from_file
    char providers[10][3][12] = {0};  // Initialize all elements to 0
    char clients[10][3][12] = {0};    // Initialize all elements to 0

    int num_providers = load_from_file("providers.txt", providers);
    int num_clients = load_from_file("clients.txt", clients);

    int role;
    role = determine_role();
    printf("%d\n", role);

    // Define input variables
    char name[12];
    char pwd[12];
    char skill[12];
    char location[12];
    char new_password[12];
    char new_user_name[12];

    printf("Enter name: ");
    (void)fgets(name, sizeof(name), stdin);  // Ignore return value explicitly
    name[strcspn(name, "\n")] = '\0';  // Null-terminate the string

    printf("Enter password: ");
    (void)fgets(pwd, sizeof(pwd), stdin);
    pwd[strcspn(pwd, "\n")] = '\0';  // Null-terminate the string

    if ((role == 1) && (strcmp(pwd, "cli123") == 0)) {
        printf("Enter the skill you require: ");
        (void)fgets(skill, sizeof(skill), stdin);
        skill[strcspn(skill, "\n")] = '\0';

        printf("Enter your location: ");
        (void)fgets(location, sizeof(location), stdin);
        location[strcspn(location, "\n")] = '\0';

        printf("Here's a list of the providers in your location for the skills you require: \n");
        print_matches(providers, num_providers, skill, location);
    } else if ((role == 2) && (strcmp(pwd, "pro456") == 0)) {
        printf("Enter the skill you provide: ");
        (void)fgets(skill, sizeof(skill), stdin);
        skill[strcspn(skill, "\n")] = '\0';

        printf("Enter your location: ");
        (void)fgets(location, sizeof(location), stdin);
        location[strcspn(location, "\n")] = '\0';

        printf("Here's a list of the clients in your location for the skills you provide: \n");
        print_matches(clients, num_clients, skill, location);
    } else {
        printf("Welcome, administrator\n");
        printf("Enter name of user to create: \n");
        (void)fgets(new_user_name, sizeof(new_user_name), stdin);
        new_user_name[strcspn(new_user_name, "\n")] = '\0';

        printf("Enter password for that user: \n");
        (void)fgets(new_password, sizeof(new_password), stdin);
        new_password[strcspn(new_password, "\n")] = '\0';

        printf("Creating new user with name: %s and password: %s\n", new_user_name, new_password);
    }

    return 0;
}

